<!DOCTYPE html>
<html lang="en">
<head>
<title>Local Docker Development DNS</title>
<meta name="go-import" content="ldddns.arnested.dk git https://github.com/arnested/ldddns.git"/>
<meta name="description" content="A systemd service that will monitor your Docker host and provide DNS names for containers based of the container name." />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link type="image/png" sizes="16x16" rel="icon" href="/favicons/16.png" media="(prefers-color-scheme: light)" />
<link type="image/png" sizes="32x32" rel="icon" href="/favicons/32.png" media="(prefers-color-scheme: light)" />
<link type="image/png" sizes="96x96" rel="icon" href="/favicons/96.png" media="(prefers-color-scheme: light)"/>
<link type="image/png" sizes="120x120" rel="icon" href="/favicons/120.png" media="(prefers-color-scheme: light)"/>
<link type="image/png" sizes="16x16" rel="icon" href="/favicons/dark-16.png" media="(prefers-color-scheme: dark)" />
<link type="image/png" sizes="32x32" rel="icon" href="/favicons/dark-32.png" media="(prefers-color-scheme: dark)" />
<link type="image/png" sizes="96x96" rel="icon" href="/favicons/dark-96.png" media="(prefers-color-scheme: dark)"/>
<link type="image/png" sizes="120x120" rel="icon" href="/favicons/dark-120.png" media="(prefers-color-scheme: dark)"/>
<style>
html {
  background-color: white;
  color: black;
  font-family: system-ui, -apple-system;
  font-size: 16px;
  line-height: 1.6;
}

body {
  padding: 0 2em;
  max-width: 62em;
  margin: 10ex auto;
}

code {
  background-color: whitesmoke;
  color: darkslategrey;
  padding: 0.5ex 0.5em;
  border-radius: 0.75em;
  overflow-x: auto;
}

code.language-ini,
code.language-console {
  padding: 2ex 1em;
  margin: 2ex 0;
  display: block;
}

code.language-console::before {
  content: "$ ";
  color: black;
  font-weight: bold;
}

@media (prefers-color-scheme: dark) {
  html {
    background-color: black;
    color: white;
  }

  code {
    background-color: darkslategrey;
    color: whitesmoke;
  }

  code.language-console::before {
    color: white;
  }

  a:active, a:link, a:hover, a:visited {
    color: white;
    font-weight: bold;
  }
}
</style>
</head>
<body>
    <main>
        <h1 id="local-docker-development-dns" tabindex="-1"><a class="anchor" href="#local-docker-development-dns" aria-hidden="true"><span class="octicon octicon-link"></span></a> Local Docker Development DNS</h1>
<p>A systemd service that will monitor your Docker host and provide
DNS names for the containers.</p>
<p>The service broadcasts the domain names using multicast DNS
(a.k.a. mDNS, zeroconf, Bonjour, Avahi).</p>
<p>A limitation of this is that domains name can only be on the <code>.local</code>
TLD and only have one level below the TLD. A benefit is that you don't
have to change your DNS server or configure stuff in <code>/etc/resolv</code> or
similar.</p>
<p>If the containers also have exposed ports (and the ports can be looked
up in <code>/etc/services</code>) the service will also broadcast the
service/domain for service discovery. I.e., <code>_https._tcp.</code> for
<a href="https://my-example.local">https://my-example.local</a> (a.k.a. DNS-SD). Only <em>one</em> domain name can
be broadcast per service per container.</p>
<p>Per default domain names will be generated from the <code>VIRTUAL_HOST</code>
environment variable is present (several hostnames can be separated by
space or comma) and from the container name.</p>
<p>If the hostnames do not fulfill the rule of being on the <code>.local</code> TLD
and have only one level below the service will rewrite it.
I.e. <code>my.example.com</code> will be rewritten to <code>my-example.local</code>.</p>
<h2 id="configuration" tabindex="-1"><a class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a> Configuration</h2>
<p>You can configure where the service should look for hostnames:</p>
<ul>
<li>Environment variables (configured with <code>env:&lt;VAR_NAME&gt;</code>) - several
hostnames can be separated by spaces or commas.</li>
<li>Container name (configured with <code>containerName</code>) - the container
name will never be a valid hostname to begin with, but as mentioned
the <code>ldddns</code> will rewrite it into one.</li>
<li>Labels (configured with <code>label:&lt;label.name&gt;</code>) - several hostnames
can be separated by spaces or commas.</li>
</ul>
<p>You configure it be setting the environment variable
<code>LDDDNS_HOSTNAME_LOOKUP</code> in a systemd unit override file.</p>
<p>For example, you could create a file named
<code>/etc/systemd/system/ldddns.service.d/override.conf</code> with the content:</p>
<pre><code class="language-ini"><span class="hljs-section">[Service]</span>
<span class="hljs-attr">Environment</span>=LDDDNS_HOSTNAME_LOOKUP=env:VIRTUAL_HOST,label:org.example.my.hostname,env:OTHER_VAR,containerName
</code></pre>
<p>This will create a hostname for all hostnames in the <code>VIRTUAL_HOST</code>
environment variable, the <code>org.example.my.hostname</code> label, the
<code>OTHER_VAR</code> environment variable, and the container name.</p>
<p>The first hostname found will be broadcast as a DNS-SD service.</p>
<p>Containers started with <code>docker-compose run</code> are ignored by
default. You can included them by setting the environment variable
<code>LDDDNS_IGNORE_DOCKER_COMPOSE_ONEOFF</code> to <code>false</code>.</p>
<p>The default configuration is the equivalent of setting:</p>
<pre><code class="language-ini"><span class="hljs-section">[Service]</span>
<span class="hljs-attr">Environment</span>=LDDDNS_HOSTNAME_LOOKUP=env:VIRTUAL_HOST,containerName
<span class="hljs-attr">Environment</span>=LDDDNS_IGNORE_DOCKER_COMPOSE_ONE<span class="hljs-literal">OFF</span>=<span class="hljs-literal">true</span>
</code></pre>
<h2 id="install" tabindex="-1"><a class="anchor" href="#install" aria-hidden="true"><span class="octicon octicon-link"></span></a> Install</h2>
<p>For Pop!_OS, Ubuntu, Debian and the like, download the <code>.deb</code> package
file from the <a href="https://github.com/arnested/ldddns/releases/latest">latest
release</a> and open
it or run:</p>
<pre><code class="language-console">sudo dpkg -i <a href="https://github.com/arnested/ldddns/releases/latest/download/ldddns_1.0.375_linux_amd64.deb">ldddns_1.0.375_linux_amd64.deb</a>
</code></pre>
<p>Or just run the following command which will download and install the
latest package for you:</p>
<pre><code class="language-console">curl -fsSL https://ldddns.arnested.dk/install.sh | bash
</code></pre>
<p>For other distributions download the binary from the <a href="https://github.com/arnested/ldddns/releases/latest">latest
release</a> and
create a systemd service unit file yourself based on
<a href="https://github.com/arnested/ldddns/blob/main/systemd/ldddns.service"><code>ldddns.service</code></a>.</p>
<h3 id="updates" tabindex="-1"><a class="anchor" href="#updates" aria-hidden="true"><span class="octicon octicon-link"></span></a> Updates</h3>
<p>When you install the package it will add an APT source list so, you
will receive future updates to <code>ldddns</code> along with your other system
updates.</p>
<h2 id="keeping-an-eye-on-things" tabindex="-1"><a class="anchor" href="#keeping-an-eye-on-things" aria-hidden="true"><span class="octicon octicon-link"></span></a> Keeping an eye on things</h2>
<p>You can get the status of the service by running:</p>
<pre><code class="language-console">sudo systemctl status ldddns.service
● ldddns.service - Local Docker Development DNS
     Loaded: loaded (/lib/systemd/system/ldddns.service; enabled; vendor preset: enabled)
     Active: active (running) since Mon 2022-01-03 09:13:14 CET; 5 days ago
       Docs: https://ldddns.arnested.dk
   Main PID: 5414 (ldddns)
     Status: "v1.0.13; {"HostnameLookup":["env:VIRTUAL_HOST","containerName"],"IgnoreDockerComposeOneoff":true}"
      Tasks: 14 (limit: 47870)
     Memory: 13.7M
        CPU: 6.243s
     CGroup: /system.slice/ldddns.service
             └─5414 /usr/libexec/ldddns start

jan 07 12:46:11 pop-os systemd[1]: Starting Local Docker Development DNS...
jan 07 12:46:11 pop-os ldddns[5414]: Starting ldddns v1.0.13...
jan 07 12:46:11 pop-os systemd[1]: Started Local Docker Development DNS.
jan 07 12:46:11 pop-os ldddns[5414]: Rewrote hostname from "my.example.com" to "my-example.local"
jan 07 12:46:11 pop-os ldddns[5414]: added address for "my-example.local" pointing to "172.18.0.2"
jan 07 12:46:11 pop-os ldddns[5414]: added service "_https._tcp" pointing to "my-example.local"
</code></pre>
<p>Or follow the log with:</p>
<pre><code class="language-console">sudo journalctl --follow --unit ldddns.service
</code></pre>
<h2 id="bugs-thoughts-and-comments" tabindex="-1"><a class="anchor" href="#bugs-thoughts-and-comments" aria-hidden="true"><span class="octicon octicon-link"></span></a> Bugs, thoughts, and comments</h2>
<p>Bugs, thoughts, and comments are welcome.</p>
<p>Feel free to get in touch at <a href="https://github.com/arnested/ldddns/issues">GitHub
Issues</a> and <a href="https://github.com/arnested/ldddns/discussions">GitHub
Discussions</a>.</p>

    </main>
<hr>
Copyright &copy; 2020, 2021, 2022, 2023, 2024 <a href="https://arnested.dk">Arne Jørgensen</a> &mdash; <a href="https://github.com/arnested/ldddns/blob/main/LICENSE.md">MIT License</a> &mdash; <a href="https://github.com/arnested/ldddns">GitHub</a> &mdash; <a href="https://bsky.app/profile/ldddns.arnested.dk">Bluesky</a>
</body>
</html>
