#!/bin/sh

set -e

docker_version=$(/usr/bin/docker version --format '{{ .Server.APIVersion }}')

/usr/bin/sed -i "s/\(DOCKER_API_VERSION=\).*/\1${docker_version}/" /etc/default/ldddns

/bin/systemctl daemon-reload

if /bin/systemctl is-active --quiet ldddns.service; then
    /bin/systemctl restart ldddns.service
fi

if ! /bin/systemctl is-enabled --quiet ldddns.service; then
    /bin/systemctl enable --now ldddns.service;
fi

echo "deb https://ldddns.arnested.dk/ ./" > /etc/apt/sources.list.d/ldddns.list

cat <<'EOK' > /etc/apt/trusted.gpg.d/ldddns.asc
-----BEGIN PGP PUBLIC KEY BLOCK-----

mQENBE7X4nwBCAC9GGtiL7ZaDqAr19KySmkLsTPaBsuoeMikXBxLiLxLPSiEpN7g
tK3IMtth1WsxieivYSkakAcTdrtLJ1R236lgmwomHiY7Agiur7SUYr2a4V4RIA4z
4L1kirhIouGvrcXrDHMqhbdY1qShNCuBC6pUzF5CiWTad/aDzR7jGiWh0TnoT1eG
CvFyvY+1CMBJWUK7hJ88uKdk34cUFcmewTsJqXYKtvy+rwf27wpLEgLCquBbTo7D
h0SQtkPrxCsleVAAEZkDIRZOAz0aH0W3OAwIUZCgK7mrY9S5XRVXfWxtjxlePUsi
2/+Nfo1nrwV2yzcIEW2gVXWjkLH3cyqFpQOjABEBAAG0KWtleWJhc2UuaW8vYXJu
ZXN0ZWQgPGFybmVzdGVkQGtleWJhc2UuaW8+iQEtBBMBCgAXBQJO1+J8AhsDAwsJ
BwMVCggCHgECF4AACgkQE5fbeSCrE6ggNAgAmChXAl+gvBUaLbdMxxxxqqumQQ9k
itY5v4tMrYf6CSH8Ay5XzuQYKjeAtuy5PFYL4j5NSEt8Cu/UnCZEYVzhlT6o0Yi2
fsoRInl7JiQpUgiQAD4zkCvepByRxwqMZft8nMgKxTGV5HH9j2HON9B/1/OvkxqD
k2r7zIP55pTorqZyx8kZNcARYD2AehnwRi1Y41NDr0qMgG/n2Yq51UdjE7d/DJnc
jn9x67BdquZhxnD1Jfg6N2vYMuQozMjD9NgUH0B0b1lOAFWwuQD8q//hSFknE/vH
8oB+GDU1kkc90DQgTyKwZOpFtI4tSkAqfgJcoHblUWRrXWfdlbnpAgRsILQiQXJu
ZSBKw7hyZ2Vuc2VuIDxhcm5lQGFybmVzdGVkLmRrPokBOAQTAQIAIgUCTtfifAIb
AwYLCQgHAwIGFQgCCQoLBBYCAwECHgECF4AACgkQE5fbeSCrE6g6FwgAmrOPovPr
6e0cKSXjM1Dnlg5LAOi2viHicyDpT4IyxLyp0am83QF08VlYpz1b2ZzTDU4p6Qku
Zg09GmM7MQgqk7u4Q8a2BBVPHq4hcpv0/wDE7lzsopDcCTFuavZxERNsE8U2y6OV
gAShIH6x48HBYYbFbXNI8QhebjRvFlbMZNaZNvYr+ZoFcm8YvgpVq/q26ZsSPJTZ
OZJP8SXqS3cLEdRvn9ngHU6EeXY6/TOP7Knh+SUJ8ndR3JrRC7AtEoduvJ4d43DJ
incJ5AnqYBoX4T55it56uBQTrd44zpt+yK6gYAgFqsWBU/0sU/Xmo+bzyOIwXy9/
Unc0m7BsbCimjdHQL9AtARAAAQEAAAAAAAAAAAAAAAD/2P/gABBKRklGAAEBAAAB
AAEAAP/+ADtDUkVBVE9SOiBnZC1qcGVnIHYxLjAgKHVzaW5nIElKRyBKUEVHIHY2
MiksIHF1YWxpdHkgPSA5MAr/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYI
DAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/2wBDAQMEBAUE
BQkFBQkUDQsNFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQU
FBQUFBQUFBQUFBT/wAARCABgAGADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAA
AAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEG
E1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RF
RkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKj
pKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP0
9fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgEC
BAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLR
ChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0
dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbH
yMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD9G4Is
gduKtJH90L05yaWGIDA9O1SXP7mymlMy26ojOZXIAUAZJJPA+prmSO5s8n/aF+K+
v/Cjw6moeH9K0zVnQFrlNT1CGzRF7Yd5F5PPAB/kD+cHiX/gqN8RLu6W1tZ7XSpI
fkkEEActg4wSwwSQBz6npinftf8Ax8vfFWuX89hJbXWnOrw291cWwl+XI/ex7myp
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
rreCVLhtFvxK2pYhkrug
=IAfj
-----END PGP PUBLIC KEY BLOCK-----
EOK
